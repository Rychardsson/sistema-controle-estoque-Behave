# üöÄ Sistema de Controle de Estoque com Behave

[![Python](https://img.shields.io/badge/Python-3.13+-blue.svg)](https://python.org)
[![Behave](https://img.shields.io/badge/BDD-Behave-green.svg)](https://behave.readthedocs.io/)
[![SQLite](https://img.shields.io/badge/Database-SQLite-lightblue.svg)](https://sqlite.org/)
[![Tests](https://img.shields.io/badge/Tests-15%20scenarios%20‚úÖ-brightgreen.svg)](#testes)

Um sistema completo de controle de estoque desenvolvido com **arquitetura limpa** e **regras de neg√≥cio robustas**, validado atrav√©s de **testes automatizados BDD (Behavior Driven Development)** usando Behave.

## üéØ Funcionalidades Principais

- ‚úÖ **Cadastro completo de produtos** (nome, descri√ß√£o, pre√ßo, estoque)
- ‚úÖ **Movimenta√ß√µes de estoque** (entradas e sa√≠das com rastreabilidade)
- ‚úÖ **üö´ Preven√ß√£o rigorosa de estoque negativo** (regra de neg√≥cio cr√≠tica)
- ‚úÖ **Rec√°lculo autom√°tico** do total de estoque por produto
- ‚úÖ **Valida√ß√£o de limites** (impede retiradas maiores que o dispon√≠vel)
- ‚úÖ **Relat√≥rios de estoque** em tempo real
- ‚úÖ **Alertas de estoque baixo** configur√°veis
- ‚úÖ **Hist√≥rico completo** de todas as movimenta√ß√µes
- ‚úÖ **Transa√ß√µes at√¥micas** (consist√™ncia de dados garantida)

## üõ†Ô∏è Tecnologias e Ferramentas

- **Python 3.13+** - Linguagem principal
- **SQLite** - Banco de dados relacional
- **Behave** - Framework BDD para testes comportamentais
- **Pytest** - Framework para testes unit√°rios
- **Dataclasses** - Modelagem de dados moderna
- **Context Managers** - Gerenciamento seguro de recursos

## üèóÔ∏è Arquitetura do Sistema

O projeto segue os princ√≠pios de **Clean Architecture** com separa√ß√£o clara de responsabilidades:

```
sistema-controle-estoque-Behave/
‚îú‚îÄ‚îÄ üìÅ src/                          # C√≥digo fonte principal
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ models/                   # Entidades de dom√≠nio
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ produto.py               # Modelo Produto
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ movimentacao.py          # Modelo Movimenta√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ services/                 # Regras de neg√≥cio
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ produto_service.py       # CRUD de produtos
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ estoque_service.py       # L√≥gica de estoque
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ database/                 # Camada de dados
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ connection.py            # Gerenciamento de conex√µes
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migrations.py            # Scripts de cria√ß√£o de tabelas
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ exceptions/               # Exce√ß√µes customizadas
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îî‚îÄ‚îÄ estoque_exceptions.py    # Exce√ß√µes de regras de neg√≥cio
‚îú‚îÄ‚îÄ üìÅ features/                     # Testes BDD (Behave)
‚îÇ   ‚îú‚îÄ‚îÄ environment.py               # Configura√ß√£o do ambiente de teste
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ steps/                    # Implementa√ß√£o dos steps
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ produto_steps.py         # Steps para produtos
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ estoque_steps.py         # Steps para estoque
‚îÇ   ‚îú‚îÄ‚îÄ produto.feature              # Cen√°rios de produtos
‚îÇ   ‚îî‚îÄ‚îÄ estoque.feature              # Cen√°rios de estoque
‚îú‚îÄ‚îÄ üìÅ tests/                        # Testes unit√°rios
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ test_produto_service.py      # Testes do ProdutoService
‚îÇ   ‚îî‚îÄ‚îÄ test_estoque_service.py      # Testes do EstoqueService
‚îú‚îÄ‚îÄ üìÑ main.py                       # Demonstra√ß√£o do sistema
‚îú‚îÄ‚îÄ üìÑ setup_db.py                   # Script de inicializa√ß√£o do banco
‚îú‚îÄ‚îÄ üìÑ behave.ini                    # Configura√ß√£o do Behave
‚îú‚îÄ‚îÄ üìÑ requirements.txt              # Depend√™ncias Python
‚îî‚îÄ‚îÄ üìÑ README.md                     # Documenta√ß√£o
```

### üé® Padr√µes Arquiteturais Utilizados

- **Repository Pattern** - Abstra√ß√£o da camada de dados
- **Service Layer** - Encapsulamento das regras de neg√≥cio
- **Dependency Injection** - Invers√£o de depend√™ncias para testabilidade
- **Exception Handling** - Tratamento espec√≠fico de erros de dom√≠nio
- **Transactional Pattern** - Garantia de consist√™ncia em opera√ß√µes complexas

## üöÄ Instala√ß√£o e Configura√ß√£o

### Pr√©-requisitos

- **Python 3.13+** instalado
- **Git** para clonagem do reposit√≥rio

### Passos para instala√ß√£o

1. **Clone o reposit√≥rio:**

   ```bash
   git clone https://github.com/Rychardsson/sistema-controle-estoque-Behave.git
   cd sistema-controle-estoque-Behave
   ```

2. **Instale as depend√™ncias:**

   ```bash
   pip install -r requirements.txt
   ```

3. **Configure o banco de dados:**

   ```bash
   python setup_db.py
   ```

4. **Execute a demonstra√ß√£o:**
   ```bash
   python main.py
   ```

## üß™ Executando os Testes

### Testes BDD (Behave) - Comportamentais

```bash
# Executar todos os testes BDD
behave

# Executar feature espec√≠fica
behave features/estoque.feature

# Executar com sa√≠da detalhada
behave -v

# Executar cen√°rio espec√≠fico
behave -n "Impedir sa√≠da de produto com estoque insuficiente"
```

### Testes Unit√°rios (Pytest)

```bash
# Executar todos os testes unit√°rios
pytest tests/

# Executar com relat√≥rio de cobertura
pytest tests/ --cov=src

# Executar com sa√≠da detalhada
pytest tests/ -v
```

### üìä Resultados dos Testes (√öltima Execu√ß√£o)

- ‚úÖ **2 features** executadas com sucesso
- ‚úÖ **15 cen√°rios** BDD aprovados (100% de sucesso)
- ‚úÖ **71 steps** implementados e funcionando
- ‚úÖ **Tempo de execu√ß√£o:** 0.3 segundos
- ‚úÖ **Cobertura:** Todas as regras de neg√≥cio validadas

## üóÑÔ∏è Modelagem do Banco de Dados

O sistema utiliza **SQLite** com estrutura otimizada para controle de estoque:

### üìã Tabela: `produtos`

| Campo            | Tipo                 | Descri√ß√£o                           |
| ---------------- | -------------------- | ----------------------------------- |
| `id`             | INTEGER PRIMARY KEY  | Identificador √∫nico auto-incremento |
| `nome`           | TEXT NOT NULL UNIQUE | Nome do produto (√∫nico)             |
| `descricao`      | TEXT                 | Descri√ß√£o detalhada do produto      |
| `preco_unitario` | REAL DEFAULT 0.0     | Pre√ßo unit√°rio do produto           |
| `estoque_atual`  | INTEGER DEFAULT 0    | Quantidade atual em estoque         |
| `created_at`     | TIMESTAMP            | Data/hora de cria√ß√£o                |
| `updated_at`     | TIMESTAMP            | Data/hora da √∫ltima atualiza√ß√£o     |

### üìã Tabela: `movimentacoes`

| Campo        | Tipo                | Descri√ß√£o                                   |
| ------------ | ------------------- | ------------------------------------------- |
| `id`         | INTEGER PRIMARY KEY | Identificador √∫nico auto-incremento         |
| `produto_id` | INTEGER FOREIGN KEY | Refer√™ncia ao produto                       |
| `tipo`       | TEXT CHECK          | Tipo da movimenta√ß√£o ('entrada' ou 'saida') |
| `quantidade` | INTEGER CHECK > 0   | Quantidade movimentada                      |
| `observacao` | TEXT                | Observa√ß√µes sobre a movimenta√ß√£o            |
| `created_at` | TIMESTAMP           | Data/hora da movimenta√ß√£o                   |

### üîó Relacionamentos

- **produtos** 1:N **movimentacoes** (Um produto pode ter v√°rias movimenta√ß√µes)
- **Integridade referencial** garantida com Foreign Keys
- **Triggers autom√°ticos** para atualiza√ß√£o de timestamps

## üí° Exemplos de Uso e Cen√°rios BDD

### üéØ Cen√°rio Principal: Preven√ß√£o de Estoque Negativo

```gherkin
Feature: Controle de Estoque
  Como um usu√°rio do sistema de estoque
  Eu quero controlar movimenta√ß√µes de entrada e sa√≠da
  Para manter o invent√°rio atualizado e evitar rupturas

  Scenario: Impedir sa√≠da de produto com estoque insuficiente
    Given o produto "Cabo HDMI" tem 5 unidades no estoque
    When tento registrar uma sa√≠da de 6 unidades
    Then o sistema deve exibir "Estoque insuficiente"
    And n√£o deve alterar o estoque
    And o estoque deve permanecer 5
```

### üìù Outros Cen√°rios Implementados

<details>
<summary><b>üîç Clique para ver todos os cen√°rios testados</b></summary>

#### Gest√£o de Produtos

```gherkin
Scenario: Cadastrar um novo produto
  When eu cadastro um produto "Notebook Dell" com pre√ßo 2500.00
  Then o produto "Notebook Dell" deve estar cadastrado
  And o produto "Notebook Dell" deve ter pre√ßo 2500.00

Scenario: Cadastrar produto com nome duplicado
  Given que existe um produto "Mouse Logitech"
  When eu cadastro um produto "Mouse Logitech"
  Then deve retornar erro "J√° existe um produto com o nome"
```

#### Movimenta√ß√µes de Estoque

```gherkin
Scenario: Registrar entrada de estoque
  Given que existe um produto "Smartphone Samsung"
  When eu registro uma entrada de 20 unidades do produto "Smartphone Samsung"
  Then o estoque do produto "Smartphone Samsung" deve ser 20 unidades
  And deve ser criada uma movimenta√ß√£o de entrada

Scenario: Registrar m√∫ltiplas entradas e sa√≠das
  Given o produto "Pen Drive 32GB" tem 0 unidades no estoque
  When eu registro uma entrada de 50 unidades do produto "Pen Drive 32GB"
  And eu registro uma sa√≠da de 15 unidades do produto "Pen Drive 32GB"
  And eu registro uma entrada de 10 unidades do produto "Pen Drive 32GB"
  And eu registro uma sa√≠da de 20 unidades do produto "Pen Drive 32GB"
  Then o estoque do produto "Pen Drive 32GB" deve ser 25 unidades
```

#### Valida√ß√µes de Regras de Neg√≥cio

```gherkin
Scenario: Tentar registrar entrada com quantidade zero
  Given que existe um produto "Mouse Wireless"
  When tento registrar uma entrada de 0 unidades do produto "Mouse Wireless"
  Then deve retornar erro de movimenta√ß√£o inv√°lida

Scenario: Estoque exato - retirar toda quantidade dispon√≠vel
  Given o produto "Adaptador HDMI" tem 3 unidades no estoque
  When eu registro uma sa√≠da de 3 unidades do produto "Adaptador HDMI"
  Then o estoque do produto "Adaptador HDMI" deve ser 0 unidades
```

</details>

### üñ•Ô∏è Demonstra√ß√£o em Terminal

```bash
# Execute a demonstra√ß√£o completa
python main.py
```

**Sa√≠da esperada:**

```
üöÄ Sistema de Controle de Estoque com Behave
==================================================
üì¶ 1. CADASTRANDO PRODUTOS
   ‚úÖ Notebook Dell Inspiron - R$ 2500.00
   ‚úÖ Mouse Logitech MX - R$ 350.00
   ‚úÖ Cabo HDMI 2m - R$ 45.00

üìà 2. REGISTRANDO ENTRADAS DE ESTOQUE
   üì• Notebook Dell Inspiron: +10 unidades (Total: 10)
   üì• Mouse Logitech MX: +25 unidades (Total: 25)

üö´ 4. TESTANDO REGRA DE NEG√ìCIO - ESTOQUE INSUFICIENTE
   ‚ùå ERRO: Estoque insuficiente para o produto 'Cabo HDMI 2m'
   ‚úÖ Sistema protegeu contra estoque negativo!
```

## üõ°Ô∏è Regras de Neg√≥cio Implementadas

### ‚úÖ Valida√ß√µes Cr√≠ticas

1. **üö´ Estoque Nunca Negativo**

   - Sistema bloqueia qualquer opera√ß√£o que resulte em estoque < 0
   - Valida√ß√£o em tempo real antes de executar movimenta√ß√µes
   - Rollback autom√°tico em caso de tentativa inv√°lida

2. **üìä Consist√™ncia de Dados**

   - Transa√ß√µes at√¥micas para opera√ß√µes complexas
   - Atualiza√ß√£o autom√°tica de estoque ap√≥s movimenta√ß√µes
   - Timestamps autom√°ticos para auditoria

3. **üîç Valida√ß√µes de Entrada**

   - Quantidade deve ser sempre > 0
   - Produtos devem existir antes de movimenta√ß√µes
   - Nomes de produtos devem ser √∫nicos

4. **üìà Rec√°lculos Autom√°ticos**
   - Estoque recalculado baseado no hist√≥rico de movimenta√ß√µes
   - Relat√≥rios em tempo real
   - Alertas de estoque baixo configur√°veis

### ‚ö° Performance e Confiabilidade

- **√çndices otimizados** no banco de dados
- **Connection pooling** para opera√ß√µes eficientes
- **Tratamento de exce√ß√µes** espec√≠fico por dom√≠nio
- **Logs detalhados** para troubleshooting

## ü§ù Contribuindo

### Como contribuir:

1. **Fork** este reposit√≥rio
2. Crie uma **branch** para sua feature (`git checkout -b feature/AmazingFeature`)
3. **Implemente** sua funcionalidade com testes
4. **Execute** todos os testes: `behave && pytest`
5. **Commit** suas mudan√ßas (`git commit -m 'Add: Amazing Feature'`)
6. **Push** para a branch (`git push origin feature/AmazingFeature`)
7. Abra um **Pull Request**

### Padr√µes de c√≥digo:

- Siga **PEP 8** para formata√ß√£o Python
- Escreva **testes BDD** para novas funcionalidades
- Documente **regras de neg√≥cio** complexas
- Use **type hints** sempre que poss√≠vel

## üìö Recursos Adicionais

### üìñ Documenta√ß√£o Relacionada

- [Behave Documentation](https://behave.readthedocs.io/) - Framework BDD
- [Python SQLite3](https://docs.python.org/3/library/sqlite3.html) - Banco de dados
- [Pytest Documentation](https://pytest.org/) - Framework de testes

### üéì Conceitos Aplicados

- **Behavior Driven Development (BDD)**
- **Test Driven Development (TDD)**
- **Clean Architecture**
- **Domain Driven Design (DDD)**
- **SOLID Principles**

## üìÑ Licen√ßa

Este projeto est√° sob a licen√ßa **MIT**. Veja o arquivo `LICENSE` para mais detalhes.

## üë®‚Äçüíª Autor

**Rychardsson** - [GitHub](https://github.com/Rychardsson)

---

<div align="center">

### ‚≠ê Se este projeto foi √∫til, considere dar uma estrela!

**Sistema de Controle de Estoque com Behave** - Desenvolvido com ‚ù§Ô∏è e Python

</div>
